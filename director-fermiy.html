<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üë®‚Äçüíº –ü–∞–Ω–µ–ª—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ - fermiy.ru</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }

        .header h1 {
            color: #1e293b;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            color: #64748b;
            font-size: 1.1rem;
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 15px;
            padding: 10px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .tab.active {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }

        .tab:not(.active) {
            color: #64748b;
        }

        .tab:not(.active):hover {
            background: #f1f5f9;
        }

        .content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .upload-area {
            border: 2px dashed #cbd5e1;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: #3b82f6;
            background: #f8fafc;
        }

        .upload-area.dragover {
            border-color: #10b981;
            background: #f0fdf4;
        }

        .file-input {
            display: none;
        }

        .upload-button {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .upload-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
        }

        .file-info {
            margin-top: 15px;
            padding: 15px;
            background: #f1f5f9;
            border-radius: 8px;
            color: #475569;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
            display: none;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #059669);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            color: #64748b;
            font-weight: 500;
        }

        .message {
            padding: 15px 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: 500;
            display: none;
        }

        .message.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .message.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        .message.info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }

        .menu-display {
            display: none;
            margin-top: 30px;
        }

        .menu-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 10px;
            text-align: center;
        }

        .menu-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            min-width: 120px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .day-section {
            margin-bottom: 30px;
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e2e8f0;
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .day-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #1e293b;
        }

        .day-count {
            background: #10b981;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .meal-type {
            margin-bottom: 20px;
        }

        .meal-type-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 10px;
            padding: 8px 15px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #10b981;
        }

        .dishes-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 10px;
        }

        .dish-item {
            background: white;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            font-size: 0.95rem;
            color: #374151;
        }

        .actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .action-button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-button.primary {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
        }

        .action-button.secondary {
            background: #f1f5f9;
            color: #475569;
            border: 1px solid #cbd5e1;
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
        }

        .json-output {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
            display: none;
        }

        .users-section {
            display: none;
        }

        .user-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .user-card {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            text-align: center;
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .user-name {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 5px;
        }

        .user-role {
            color: #64748b;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üë®‚Äçüíº –ü–∞–Ω–µ–ª—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞</h1>
            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∫–æ–ª—å–Ω—ã–º –ø–∏—Ç–∞–Ω–∏–µ–º - fermiy.ru</p>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('menu')">
                <span>üìã</span>
                <span>–ú–ï–ù–Æ</span>
            </div>
            <div class="tab" onclick="switchTab('users')">
                <span>üë•</span>
                <span>–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò</span>
            </div>
        </div>

        <div class="content">
            <!-- –°–µ–∫—Ü–∏—è –º–µ–Ω—é -->
            <div id="menuSection">
                <div class="section">
                    <div class="section-title">
                        <span>üì§</span>
                        <span>–ó–∞–≥—Ä—É–∑–∏—Ç—å –º–µ–Ω—é –∏–∑ Excel</span>
                    </div>
                    
                    <div class="upload-area" id="uploadArea">
                        <div>
                            <div style="font-size: 3rem; margin-bottom: 15px;">üìÅ</div>
                            <h3 style="color: #374151; margin-bottom: 10px;">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ Excel —Ñ–∞–π–ª —Å—é–¥–∞</h3>
                            <p style="color: #64748b; margin-bottom: 20px;">–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞</p>
                            <button class="upload-button" onclick="document.getElementById('fileInput').click()">
                                –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª
                            </button>
                        </div>
                        <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls" />
                        <div class="file-info" id="fileInfo" style="display: none;"></div>
                    </div>

                    <div class="progress-bar" id="progressBar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-text" id="progressText"></div>

                    <div id="message" class="message"></div>
                </div>

                <div class="section">
                    <div class="section-title">
                        <span>‚öôÔ∏è</span>
                        <span>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é</span>
                    </div>
                    
                    <div class="actions">
                        <button class="action-button primary" onclick="processFile()">
                            <span>üöÄ</span>
                            <span>–ó–ê–ì–†–£–ó–ò–¢–¨</span>
                        </button>
                        <button class="action-button secondary" onclick="exportToJSON()">
                            <span>üìÑ</span>
                            <span>–≠–ö–°–ü–û–†–¢ JSON</span>
                        </button>
                        <button class="action-button secondary" onclick="exportToCSV()">
                            <span>üìä</span>
                            <span>–≠–ö–°–ü–û–†–¢ CSV</span>
                        </button>
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">
                        <span>üçΩÔ∏è</span>
                        <span>–ë–ª—é–¥–∞ –º–µ–Ω—é (<span id="totalDishes">0</span>)</span>
                    </div>
                    
                    <div class="menu-display" id="menuDisplay">
                        <div class="menu-title" id="menuTitle"></div>
                        
                        <div class="menu-stats" id="menuStats"></div>
                        
                        <div id="menuGrid"></div>
                        
                        <div class="json-output" id="jsonOutput"></div>
                    </div>
                </div>
            </div>

            <!-- –°–µ–∫—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
            <div id="usersSection" class="users-section">
                <div class="section">
                    <div class="section-title">
                        <span>üë•</span>
                        <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</span>
                    </div>
                    
                    <div class="user-stats">
                        <div class="user-card">
                            <div class="user-avatar">üë®‚Äçüíº</div>
                            <div class="user-name">–î–∏—Ä–µ–∫—Ç–æ—Ä</div>
                            <div class="user-role">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</div>
                        </div>
                        <div class="user-card">
                            <div class="user-avatar">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                            <div class="user-name">–†–æ–¥–∏—Ç–µ–ª–∏</div>
                            <div class="user-role">150+ —Å–µ–º–µ–π</div>
                        </div>
                        <div class="user-card">
                            <div class="user-avatar">üë®‚Äçüç≥</div>
                            <div class="user-name">–ü–æ–≤–∞—Ä–∞</div>
                            <div class="user-role">5 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedFile = null;
        let parsedMenu = null;

        const dayNames = ["", "–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", "–í—Ç–æ—Ä–Ω–∏–∫", "–°—Ä–µ–¥–∞", "–ß–µ—Ç–≤–µ—Ä–≥", "–ü—è—Ç–Ω–∏—Ü–∞", "–°—É–±–±–æ—Ç–∞", "–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ"];

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function switchTab(tabName) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.closest('.tab').classList.add('active');

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏–∏
            document.getElementById('menuSection').style.display = tabName === 'menu' ? 'block' : 'none';
            document.getElementById('usersSection').style.display = tabName === 'users' ? 'block' : 'none';
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ñ–∞–π–ª–æ–≤
        document.getElementById('fileInput').addEventListener('change', handleFileSelect);
        
        const uploadArea = document.getElementById('uploadArea');
        uploadArea.addEventListener('dragover', handleDragOver);
        uploadArea.addEventListener('dragleave', handleDragLeave);
        uploadArea.addEventListener('drop', handleDrop);
        uploadArea.addEventListener('click', () => document.getElementById('fileInput').click());

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                selectedFile = file;
                showFileInfo(file);
            }
        }

        function handleDragOver(e) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                selectedFile = files[0];
                showFileInfo(files[0]);
            }
        }

        function showFileInfo(file) {
            const fileInfo = document.getElementById('fileInfo');
            fileInfo.innerHTML = `
                <strong>üìÅ ${file.name}</strong><br>
                <small>–†–∞–∑–º–µ—Ä: ${(file.size / 1024).toFixed(1)} KB</small>
            `;
            fileInfo.style.display = 'block';
            showMessage(`–§–∞–π–ª –≤—ã–±—Ä–∞–Ω: ${file.name}`, 'info');
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞
        async function processFile() {
            if (!selectedFile) {
                showMessage('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª', 'error');
                return;
            }

            try {
                showProgress(true);
                setProgress(10, '–ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞...');

                const data = await readFile(selectedFile);
                const workbook = XLSX.read(data, { type: 'array' });
                
                setProgress(30, '–ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã...');
                
                // –ò—â–µ–º –ª–∏—Å—Ç —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º —Å–æ–¥–µ—Ä–∂–∞—â–∏–º "–ù–ï–î–ï–õ–Ø"
                let targetSheet = null;
                for (const sheetName of workbook.SheetNames) {
                    if (sheetName.toLowerCase().includes('–Ω–µ–¥–µ–ª')) {
                        targetSheet = sheetName;
                        break;
                    }
                }

                if (!targetSheet) {
                    targetSheet = workbook.SheetNames[0];
                }

                const worksheet = workbook.Sheets[targetSheet];
                const jsonData = XLSX.utils.sheet_to_json(worksheet, { 
                    header: 1, 
                    raw: false,
                    defval: ''
                });

                setProgress(60, '–ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã...');
                
                const menu = parseStructuredMenu(jsonData, targetSheet);
                
                setProgress(100, '–ì–æ—Ç–æ–≤–æ!');
                
                parsedMenu = menu;
                displayMenu(menu);
                showMessage(`‚úÖ –ú–µ–Ω—é –∑–∞–≥—Ä—É–∂–µ–Ω–æ! –î–æ–±–∞–≤–ª–µ–Ω–æ ${menu.totalDishes} –±–ª—é–¥`, 'success');

            } catch (error) {
                showMessage('‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞: ' + error.message, 'error');
                console.error('–û—à–∏–±–∫–∞:', error);
            } finally {
                showProgress(false);
            }
        }

        // –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
        function readFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = (e) => reject(e);
                reader.readAsArrayBuffer(file);
            });
        }

        // –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –º–µ–Ω—é
        function parseStructuredMenu(jsonData, sheetName) {
            const menu = {
                –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫: { –ó–∞–≤—Ç—Ä–∞–∫: [], –û–±–µ–¥: [], –ü–æ–ª–¥–Ω–∏–∫: [] },
                –í—Ç–æ—Ä–Ω–∏–∫: { –ó–∞–≤—Ç—Ä–∞–∫: [], –û–±–µ–¥: [], –ü–æ–ª–¥–Ω–∏–∫: [] },
                –°—Ä–µ–¥–∞: { –ó–∞–≤—Ç—Ä–∞–∫: [], –û–±–µ–¥: [], –ü–æ–ª–¥–Ω–∏–∫: [] },
                –ß–µ—Ç–≤–µ—Ä–≥: { –ó–∞–≤—Ç—Ä–∞–∫: [], –û–±–µ–¥: [], –ü–æ–ª–¥–Ω–∏–∫: [] },
                –ü—è—Ç–Ω–∏—Ü–∞: { –ó–∞–≤—Ç—Ä–∞–∫: [], –û–±–µ–¥: [], –ü–æ–ª–¥–Ω–∏–∫: [] }
            };

            let totalDishes = 0;

            // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É - –∏—â–µ–º –ø–∞—Ä—ã —Å—Ç–æ–ª–±—Ü–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è
            const dayColumns = findDayColumns(jsonData);
            
            console.log('–ù–∞–π–¥–µ–Ω–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã –¥–Ω–µ–π:', dayColumns);

            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
            for (const [dayName, columns] of Object.entries(dayColumns)) {
                const dayData = parseDayData(jsonData, columns);
                menu[dayName] = dayData;
                totalDishes += Object.values(dayData).flat().length;
            }

            // –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–µ–¥–µ–ª–µ
            const weekMatch = sheetName.match(/(\d+)\s*–Ω–µ–¥–µ–ª/i);
            const week = weekMatch ? `–ù–µ–¥–µ–ª—è ${weekMatch[1]}` : '–¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è';

            return {
                menu,
                week,
                title: `–ú–µ–Ω—é –Ω–∞ ${week}`,
                totalDishes,
                sheetName
            };
        }

        // –ü–æ–∏—Å–∫ —Å—Ç–æ–ª–±—Ü–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è
        function findDayColumns(jsonData) {
            const dayColumns = {};
            const dayNames = ['–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞'];

            // –ò—â–µ–º –≤ –ø–µ—Ä–≤—ã—Ö 3 —Å—Ç—Ä–æ–∫–∞—Ö –Ω–∞–∑–≤–∞–Ω–∏—è –¥–Ω–µ–π
            for (let rowIndex = 0; rowIndex < Math.min(3, jsonData.length); rowIndex++) {
                const row = jsonData[rowIndex];
                if (!row) continue;

                for (let colIndex = 0; colIndex < row.length; colIndex++) {
                    const cellValue = (row[colIndex] || '').toString().trim();
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ —è—á–µ–π–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–Ω—è
                    for (const dayName of dayNames) {
                        if (cellValue.toLowerCase().includes(dayName.toLowerCase())) {
                            // –ù–∞–π–¥–µ–Ω –¥–µ–Ω—å, –∏—â–µ–º –ø–∞—Ä—É —Å—Ç–æ–ª–±—Ü–æ–≤
                            const dayCols = findDayColumnPair(jsonData, colIndex);
                            if (dayCols.length >= 1) {
                                dayColumns[dayName] = dayCols;
                            }
                            break;
                        }
                    }
                }
            }

            return dayColumns;
        }

        // –ü–æ–∏—Å–∫ –ø–∞—Ä—ã —Å—Ç–æ–ª–±—Ü–æ–≤ –¥–ª—è –¥–Ω—è
        function findDayColumnPair(jsonData, startCol) {
            const columns = [];
            
            // –ò—â–µ–º —Å—Ç–æ–ª–±—Ü—ã —Å –¥–∞–Ω–Ω—ã–º–∏ (–Ω–µ –ø—É—Å—Ç—ã–µ)
            for (let col = startCol; col < startCol + 4; col++) {
                let hasData = false;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö
                for (let row = 0; row < Math.min(20, jsonData.length); row++) {
                    const cellValue = (jsonData[row] && jsonData[row][col]) ? 
                        jsonData[row][col].toString().trim() : '';
                    
                    if (cellValue && cellValue.length > 2 && !isServiceCell(cellValue)) {
                        hasData = true;
                        break;
                    }
                }
                
                if (hasData) {
                    columns.push(col);
                }
            }
            
            return columns;
        }

        // –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö –¥–Ω—è
        function parseDayData(jsonData, columns) {
            const dayData = { –ó–∞–≤—Ç—Ä–∞–∫: [], –û–±–µ–¥: [], –ü–æ–ª–¥–Ω–∏–∫: [] };
            let currentMealType = '–ó–∞–≤—Ç—Ä–∞–∫';

            // –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ —Å—Ç—Ä–æ–∫–∞–º –∏ –∏—â–µ–º —Å–µ–∫—Ü–∏–∏ –ø–∏—Ç–∞–Ω–∏—è
            for (let rowIndex = 0; rowIndex < jsonData.length; rowIndex++) {
                const row = jsonData[rowIndex];
                if (!row) continue;

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–≤—É—é —è—á–µ–π–∫—É –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
                const firstCell = (row[0] || '').toString().trim().toLowerCase();
                
                if (firstCell.includes('–∑–∞–≤—Ç—Ä–∞–∫') || firstCell.includes('–∑  –∞  –≤  —Ç  —Ä  –∞  –∫')) {
                    currentMealType = '–ó–∞–≤—Ç—Ä–∞–∫';
                    continue;
                } else if (firstCell.includes('–æ–±–µ–¥') || firstCell.includes('–æ  –±  –µ  –¥')) {
                    currentMealType = '–û–±–µ–¥';
                    continue;
                } else if (firstCell.includes('–ø–æ–ª–¥–Ω–∏–∫') || firstCell.includes('–ø  –æ  –ª  –¥  –Ω  –∏  –∫')) {
                    currentMealType = '–ü–æ–ª–¥–Ω–∏–∫';
                    continue;
                }

                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —è—á–µ–π–∫–∏ –≤ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å—Ç–æ–ª–±—Ü–∞—Ö
                for (const colIndex of columns) {
                    const cellValue = (row[colIndex] || '').toString().trim();
                    
                    if (cellValue && cellValue.length > 3 && !isServiceCell(cellValue)) {
                        const dish = cleanDishName(cellValue);
                        if (dish && !dayData[currentMealType].includes(dish)) {
                            dayData[currentMealType].push(dish);
                        }
                    }
                }
            }

            return dayData;
        }

        // –û—á–∏—Å—Ç–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è –±–ª—é–¥–∞
        function cleanDishName(text) {
            // –£–±–∏—Ä–∞–µ–º –Ω–æ–º–µ—Ä–∞ –ø–æ—Ä—Ü–∏–π (‚Ññ 1/6, ‚Ññ 11/2, ‚Ññ15/1)
            let cleaned = text.replace(/‚Ññ\s*\d+\/\d+/g, '');
            
            // –£–±–∏—Ä–∞–µ–º –≤–µ—Å (225 –≥, 20 –≥, 200 –≥)
            cleaned = cleaned.replace(/\d+\s*–≥/g, '');
            
            // –£–±–∏—Ä–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à—Ç—É–∫ (2 —à—Ç)
            cleaned = cleaned.replace(/\d+\s*—à—Ç/g, '');
            
            // –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã –∏ –∑–Ω–∞–∫–∏ –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è
            cleaned = cleaned.replace(/\s+/g, ' ').trim();
            cleaned = cleaned.replace(/^[,\-\.\s]+|[,\-\.\s]+$/g, '');
            
            // –£–±–∏—Ä–∞–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
            const serviceWords = ['–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π', '–≥–∞—Ä–Ω–∏—Ä', '–æ–≤–æ—â–Ω–æ–π', '—Å–æ—É—Å—ã', '—Å'];
            for (const word of serviceWords) {
                if (cleaned.toLowerCase().includes(word)) {
                    return null;
                }
            }
            
            return cleaned.length > 2 ? cleaned : null;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª—É–∂–µ–±–Ω–æ–π —è—á–µ–π–∫–∏
        function isServiceCell(text) {
            const lowerText = text.toLowerCase();
            const serviceWords = [
                '‚Ññ', '–∫–æ–ª', '–∏—á–µ', '—Å—Ç–≤', '–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ', '–ø–æ—Ä—Ü–∏–π', '–ø–æ—Ä—Ü–∏–∏', '–Ω–µ–¥–µ–ª—è', '–Ω–µ–¥–µ–ª',
                '–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–≤—Ç–æ—Ä–Ω–∏–∫', '—Å—Ä–µ–¥–∞', '—á–µ—Ç–≤–µ—Ä–≥', '–ø—è—Ç–Ω–∏—Ü–∞', '—Å—É–±–±–æ—Ç–∞', '–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ',
                '–∑–∞–≤—Ç—Ä–∞–∫', '–æ–±–µ–¥', '–ø–æ–ª–¥–Ω–∏–∫', '—É–∂–∏–Ω', '–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π', '–≥–∞—Ä–Ω–∏—Ä', '–∏—Ç–æ–≥–æ', '–≤—Å–µ–≥–æ',
                '–∑  –∞  –≤  —Ç  —Ä  –∞  –∫', '–æ  –±  –µ  –¥', '–ø  –æ  –ª  –¥  –Ω  –∏  –∫'
            ];
            
            return serviceWords.some(word => lowerText.includes(word.toLowerCase()));
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–µ–Ω—é
        function displayMenu(menu) {
            document.getElementById('menuTitle').textContent = `üìã ${menu.title}`;
            document.getElementById('totalDishes').textContent = menu.totalDishes;
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            const stats = document.getElementById('menuStats');
            stats.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${menu.totalDishes}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –±–ª—é–¥</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">5</div>
                    <div class="stat-label">–î–Ω–µ–π –Ω–µ–¥–µ–ª–∏</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">3</div>
                    <div class="stat-label">–¢–∏–ø–∞ –ø–∏—Ç–∞–Ω–∏—è</div>
                </div>
            `;
            
            const menuGrid = document.getElementById('menuGrid');
            menuGrid.innerHTML = '';

            for (const [dayName, dayData] of Object.entries(menu.menu)) {
                const daySection = document.createElement('div');
                daySection.className = 'day-section';
                
                let totalDayDishes = Object.values(dayData).flat().length;
                
                daySection.innerHTML = `
                    <div class="day-header">
                        <div class="day-title">${dayName}</div>
                        <div class="day-count">${totalDayDishes} –±–ª—é–¥</div>
                    </div>
                `;

                for (const [mealType, dishes] of Object.entries(dayData)) {
                    if (dishes.length > 0) {
                        const mealTypeDiv = document.createElement('div');
                        mealTypeDiv.className = 'meal-type';
                        
                        mealTypeDiv.innerHTML = `
                            <div class="meal-type-title">${mealType} (${dishes.length} –±–ª—é–¥)</div>
                            <div class="dishes-list">
                                ${dishes.map(dish => `
                                    <div class="dish-item">${dish}</div>
                                `).join('')}
                            </div>
                        `;
                        
                        daySection.appendChild(mealTypeDiv);
                    }
                }
                
                menuGrid.appendChild(daySection);
            }

            document.getElementById('menuDisplay').style.display = 'block';
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON
        function exportToJSON() {
            if (!parsedMenu) {
                showMessage('‚ùå –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –º–µ–Ω—é', 'error');
                return;
            }
            
            const jsonOutput = document.getElementById('jsonOutput');
            jsonOutput.textContent = JSON.stringify(parsedMenu.menu, null, 2);
            jsonOutput.style.display = 'block';
            
            // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
            const blob = new Blob([JSON.stringify(parsedMenu.menu, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `menu_${parsedMenu.week.replace(/\s+/g, '_')}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showMessage('‚úÖ JSON —Ñ–∞–π–ª —Å–∫–∞—á–∞–Ω', 'success');
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
        function exportToCSV() {
            if (!parsedMenu) {
                showMessage('‚ùå –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –º–µ–Ω—é', 'error');
                return;
            }
            
            let csv = '–î–µ–Ω—å,–¢–∏–ø –ø–∏—Ç–∞–Ω–∏—è,–ë–ª—é–¥–æ\n';
            
            for (const [dayName, dayData] of Object.entries(parsedMenu.menu)) {
                for (const [mealType, dishes] of Object.entries(dayData)) {
                    for (const dish of dishes) {
                        csv += `"${dayName}","${mealType}","${dish}"\n`;
                    }
                }
            }
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `menu_${parsedMenu.week.replace(/\s+/g, '_')}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            
            showMessage('‚úÖ CSV —Ñ–∞–π–ª —Å–∫–∞—á–∞–Ω', 'success');
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
        function showProgress(show) {
            document.getElementById('progressBar').style.display = show ? 'block' : 'none';
        }

        function setProgress(percent, text) {
            document.getElementById('progressFill').style.width = `${percent}%`;
            document.getElementById('progressText').textContent = text;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = `message ${type}`;
            messageDiv.style.display = 'block';
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã—Ç—å —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>
