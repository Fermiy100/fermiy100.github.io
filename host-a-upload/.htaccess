RewriteEngine On

# Обработка OPTIONS запросов для CORS
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule .* - [R=200,L]

# Включение PHP
AddType application/x-httpd-php .php
DirectoryIndex index.html index.php

# CORS заголовки для всех ответов
Header always set Access-Control-Allow-Origin "*"
Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"
Header always set Access-Control-Max-Age "3600"

# Обработка API запросов - PHP файлы в папке api/
RewriteCond %{REQUEST_URI} ^/api/
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^api/(.*)$ api/$1 [L]

# Client-side routing для SPA - только если файл не существует
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^/api/
RewriteRule . /index.html [L]

# Безопасность
<Files "*.php">
    Order Allow,Deny
    Allow from all
</Files>

# Настройка для загрузки файлов
php_value upload_max_filesize 50M
php_value post_max_size 50M
php_value max_execution_time 300