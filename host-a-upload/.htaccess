# Включаем RewriteEngine только если модуль доступен
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /
</IfModule>

# Устанавливаем index файлы по порядку
DirectoryIndex index.php index.html

# БЕЗОПАСНОСТЬ: Закрываем доступ к JSON файлам
<FilesMatch "\.(json)$">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</FilesMatch>

# API routing - только если mod_rewrite доступен
<IfModule mod_rewrite.c>
    # Не трогаем существующие файлы и папки
    RewriteCond %{REQUEST_FILENAME} -f [OR]
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^ - [L]
    
    # API endpoints перенаправляем на соответствующие PHP файлы
    RewriteRule ^api/users$ api/users.php [L]
    RewriteRule ^api/menu$ api/menu.php [L]
    RewriteRule ^api/orders$ api/orders/index.php [L]
</IfModule>

# Настройки PHP (только если доступны)
<IfModule mod_php7.c>
    php_flag display_errors Off
    php_flag log_errors On
    php_value error_log logs/php-error.log
</IfModule>

# CORS headers для API
<IfModule mod_headers.c>
    <FilesMatch "\.php$">
        Header set Access-Control-Allow-Origin "*"
        Header set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        Header set Access-Control-Allow-Headers "Content-Type, Authorization"
    </FilesMatch>
</IfModule>