RewriteEngine On

# БЕЗОПАСНОСТЬ: Закрываем доступ к данным
<FilesMatch "(users|menu|orders)\.json$">
    Require all denied
</FilesMatch>

# Закрываем доступ к логам и кешу
<IfModule mod_authz_core.c>
    <Directory "logs">
        Require all denied
    </Directory>
    <Directory "cache">
        Require all denied
    </Directory>
</IfModule>

# Закрываем доступ к утилитам миграции
<FilesMatch "migrate-passwords\.php$">
    Require all denied
</FilesMatch>

# API routing - ВАЖНО: должно быть перед frontend routing!
RewriteRule ^api/profile/update$ api/profile/update.php [L]
RewriteRule ^api/users/([0-9]+)/delete$ api/users/delete.php [L]
RewriteRule ^api/users/list$ api/users/list.php [L]
RewriteRule ^api/users/([0-9]+)/verify$ api/users/index.php [L]
RewriteRule ^api/orders$ api/orders/index.php [L]

# Если запрашивается корень, показываем index.php
DirectoryIndex index.php index.html

# Frontend routing - только если файл не существует
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^/api/
RewriteRule ^(.*)$ index.php [QSA,L]