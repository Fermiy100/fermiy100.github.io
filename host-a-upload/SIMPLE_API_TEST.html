<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç API</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .test { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .success { border-left: 4px solid #4CAF50; }
        .error { border-left: 4px solid #f44336; }
        .warning { border-left: 4px solid #ff9800; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üß™ –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π —Å–∞–π—Ç–∞</h1>
    
    <div class="test">
        <h3>üîå –¢–µ—Å—Ç API Health</h3>
        <button onclick="testHealth()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        <div id="health-result"></div>
    </div>
    
    <div class="test">
        <h3>üçΩÔ∏è –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–Ω—é</h3>
        <button onclick="testMenu()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        <div id="menu-result"></div>
    </div>
    
    <div class="test">
        <h3>üîê –¢–µ—Å—Ç –≤—Ö–æ–¥–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞</h3>
        <button onclick="testDirectorLogin()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        <div id="director-result"></div>
    </div>
    
    <div class="test">
        <h3>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ –¢–µ—Å—Ç –≤—Ö–æ–¥–∞ —Ä–æ–¥–∏—Ç–µ–ª—è</h3>
        <button onclick="testParentLogin()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        <div id="parent-result"></div>
    </div>
    
    <div class="test">
        <h3>üë• –¢–µ—Å—Ç —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
        <button onclick="testUsers()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        <div id="users-result"></div>
    </div>
    
    <div class="test">
        <h3>üõí –¢–µ—Å—Ç –∑–∞–∫–∞–∑–æ–≤</h3>
        <button onclick="testOrders()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        <div id="orders-result"></div>
    </div>
    
    <div class="test">
        <h3>üìù –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
        <button onclick="testCreateUser()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        <div id="create-user-result"></div>
    </div>
    
    <div class="test">
        <h3>‚ûï –¢–µ—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±–ª—é–¥–∞</h3>
        <button onclick="testAddDish()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        <div id="add-dish-result"></div>
    </div>
    
    <div class="test">
        <h3>üîÑ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã</h3>
        <button onclick="runAllTests()" style="background: #28a745; font-size: 16px; padding: 15px 30px;">üöÄ –ó–ê–ü–£–°–¢–ò–¢–¨ –í–°–ï –¢–ï–°–¢–´</button>
        <div id="all-results"></div>
    </div>

    <script>
        function showResult(elementId, status, message, data = null) {
            const element = document.getElementById(elementId);
            const className = status === 'success' ? 'success' : status === 'error' ? 'error' : 'warning';
            element.className = className;
            element.innerHTML = `
                <strong>${status === 'success' ? '‚úÖ' : status === 'error' ? '‚ùå' : '‚ö†Ô∏è'} ${message}</strong>
                ${data ? `<pre>${JSON.stringify(data, null, 2)}</pre>` : ''}
            `;
        }
        
        async function testHealth() {
            try {
                const response = await fetch('/api/health.php');
                const data = await response.json();
                showResult('health-result', 'success', 'API Health —Ä–∞–±–æ—Ç–∞–µ—Ç', data);
            } catch (error) {
                showResult('health-result', 'error', `–û—à–∏–±–∫–∞: ${error.message}`);
            }
        }
        
        async function testMenu() {
            try {
                const response = await fetch('/api/menu.php');
                const data = await response.json();
                const count = Array.isArray(data) ? data.length : 0;
                showResult('menu-result', 'success', `–ú–µ–Ω—é –∑–∞–≥—Ä—É–∂–µ–Ω–æ: ${count} –±–ª—é–¥`, data.slice(0, 2));
            } catch (error) {
                showResult('menu-result', 'error', `–û—à–∏–±–∫–∞: ${error.message}`);
            }
        }
        
        async function testDirectorLogin() {
            try {
                const response = await fetch('/api/auth/login.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'director@school.test',
                        password: 'password123'
                    })
                });
                const data = await response.json();
                if (response.ok) {
                    showResult('director-result', 'success', `–î–∏—Ä–µ–∫—Ç–æ—Ä –≤–æ—à–µ–ª: ${data.user.name}`, data.user);
                } else {
                    showResult('director-result', 'error', `–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ${data.error}`);
                }
            } catch (error) {
                showResult('director-result', 'error', `–û—à–∏–±–∫–∞: ${error.message}`);
            }
        }
        
        async function testParentLogin() {
            try {
                const response = await fetch('/api/auth/login.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'parent@school.test',
                        password: 'password123'
                    })
                });
                const data = await response.json();
                if (response.ok) {
                    showResult('parent-result', 'success', `–†–æ–¥–∏—Ç–µ–ª—å –≤–æ—à–µ–ª: ${data.user.name}`, data.user);
                } else {
                    showResult('parent-result', 'error', `–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ${data.error}`);
                }
            } catch (error) {
                showResult('parent-result', 'error', `–û—à–∏–±–∫–∞: ${error.message}`);
            }
        }
        
        async function testUsers() {
            try {
                const response = await fetch('/api/users.php');
                const data = await response.json();
                const count = Array.isArray(data) ? data.length : 0;
                showResult('users-result', 'success', `–ù–∞–π–¥–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${count}`, data);
            } catch (error) {
                showResult('users-result', 'error', `–û—à–∏–±–∫–∞: ${error.message}`);
            }
        }
        
        async function testOrders() {
            try {
                const response = await fetch('/api/orders.php');
                const data = await response.json();
                const count = Array.isArray(data) ? data.length : 0;
                showResult('orders-result', 'success', `–ù–∞–π–¥–µ–Ω–æ –∑–∞–∫–∞–∑–æ–≤: ${count}`, data);
            } catch (error) {
                showResult('orders-result', 'error', `–û—à–∏–±–∫–∞: ${error.message}`);
            }
        }
        
        async function testCreateUser() {
            try {
                const response = await fetch('/api/users/create.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: '–¢–µ—Å—Ç–æ–≤—ã–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                        email: 'testuser@example.com',
                        password: 'testpass123',
                        role: 'PARENT'
                    })
                });
                const data = await response.json();
                if (response.ok) {
                    showResult('create-user-result', 'success', `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω: ${data.user.name}`, data.user);
                } else {
                    showResult('create-user-result', 'warning', `–°–æ–∑–¥–∞–Ω–∏–µ: ${data.error}`);
                }
            } catch (error) {
                showResult('create-user-result', 'error', `–û—à–∏–±–∫–∞: ${error.message}`);
            }
        }
        
        async function testAddDish() {
            try {
                const response = await fetch('/api/menu/add.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: '–¢–µ—Å—Ç–æ–≤–æ–µ –±–ª—é–¥–æ',
                        description: '–ë–ª—é–¥–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è',
                        price: 200,
                        meal_type: '–∑–∞–≤—Ç—Ä–∞–∫',
                        day_of_week: '–ü–û–ù–ï–î–ï–õ–¨–ù–ò–ö',
                        weight: '250–≥',
                        recipe_number: 'TEST/1'
                    })
                });
                const data = await response.json();
                if (response.ok) {
                    showResult('add-dish-result', 'success', `–ë–ª—é–¥–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ: ${data.dish.name}`, data.dish);
                } else {
                    showResult('add-dish-result', 'warning', `–î–æ–±–∞–≤–ª–µ–Ω–∏–µ: ${data.error}`);
                }
            } catch (error) {
                showResult('add-dish-result', 'error', `–û—à–∏–±–∫–∞: ${error.message}`);
            }
        }
        
        async function runAllTests() {
            const tests = [
                { name: 'API Health', func: testHealth },
                { name: '–ú–µ–Ω—é', func: testMenu },
                { name: '–í—Ö–æ–¥ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞', func: testDirectorLogin },
                { name: '–í—Ö–æ–¥ —Ä–æ–¥–∏—Ç–µ–ª—è', func: testParentLogin },
                { name: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏', func: testUsers },
                { name: '–ó–∞–∫–∞–∑—ã', func: testOrders },
                { name: '–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', func: testCreateUser },
                { name: '–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–ª—é–¥–∞', func: testAddDish }
            ];
            
            document.getElementById('all-results').innerHTML = '<p>‚è≥ –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Å–µ —Ç–µ—Å—Ç—ã...</p>';
            
            let successCount = 0;
            let errorCount = 0;
            let warningCount = 0;
            
            for (const test of tests) {
                try {
                    await test.func();
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                    const resultElement = document.getElementById(test.name.toLowerCase().replace(/\s+/g, '-').replace('api-', '').replace('–≤—Ö–æ–¥-', '').replace('—Å–æ–∑–¥–∞–Ω–∏–µ-', '').replace('–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ-', '') + '-result');
                    if (resultElement.classList.contains('success')) successCount++;
                    else if (resultElement.classList.contains('error')) errorCount++;
                    else if (resultElement.classList.contains('warning')) warningCount++;
                } catch (error) {
                    errorCount++;
                }
            }
            
            document.getElementById('all-results').innerHTML = `
                <div class="success">
                    <h3>üéâ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!</h3>
                    <p><strong>‚úÖ –£—Å–ø–µ—à–Ω–æ:</strong> ${successCount}</p>
                    <p><strong>‚ùå –û—à–∏–±–æ–∫:</strong> ${errorCount}</p>
                    <p><strong>‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π:</strong> ${warningCount}</p>
                    <p><strong>üìä –í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤:</strong> ${tests.length}</p>
                </div>
            `;
        }
    </script>
</body>
</html>
