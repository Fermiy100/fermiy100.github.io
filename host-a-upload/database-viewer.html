<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Å–º–æ—Ç—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö - Railway</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #fafafa;
        }
        .section h2 {
            color: #34495e;
            margin-top: 0;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #3498db;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        .stat-label {
            color: #7f8c8d;
            font-size: 14px;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .data-table th,
        .data-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .data-table th {
            background: #3498db;
            color: white;
        }
        .data-table tr:nth-child(even) {
            background: #f2f2f2;
        }
        .button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #2980b9;
        }
        .success {
            background: #27ae60;
        }
        .error {
            background: #e74c3c;
        }
        .loading {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
        }
        .json-viewer {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üóÑÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Railway</h1>
        
        <div class="section">
            <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</h2>
            <div class="stats" id="stats">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</div>
            </div>
        </div>
        
        <div class="section">
            <h2>üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
            <button class="button" onclick="loadUsers()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
            <div id="users-content">
                <div class="loading">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
            </div>
        </div>
        
        <div class="section">
            <h2>üçΩÔ∏è –ú–µ–Ω—é</h2>
            <button class="button" onclick="loadMenu()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –º–µ–Ω—é</button>
            <div id="menu-content">
                <div class="loading">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–Ω—é</div>
            </div>
        </div>
        
        <div class="section">
            <h2>üîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API</h2>
            <button class="button" onclick="testUserVerification()">‚úÖ –¢–µ—Å—Ç –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
            <button class="button success" onclick="loadFullDatabase()">üìä –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ë–î</button>
            <div id="test-content">
                <div class="loading">–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</div>
            </div>
        </div>
    </div>

    <script>
        const RAILWAY_URL = 'https://fermiy100githubio-production.up.railway.app';
        
        function log(message, elementId = 'test-content') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            element.innerHTML += `<div>[${timestamp}] ${message}</div>`;
        }
        
        function clearLog(elementId = 'test-content') {
            document.getElementById(elementId).innerHTML = '';
        }
        
        async function loadFullDatabase() {
            try {
                clearLog();
                log('üìä –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö...');
                
                const response = await fetch(`${RAILWAY_URL}/api/database`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                log('‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!');
                log(`üìä –í–µ—Ä—Å–∏—è —Å–µ—Ä–≤–µ—Ä–∞: ${data.server.version}`);
                log(`‚è±Ô∏è –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: ${Math.round(data.server.uptime)} —Å–µ–∫—É–Ω–¥`);
                log(`üçΩÔ∏è –ë–ª—é–¥ –≤ –º–µ–Ω—é: ${data.menu.totalDishes}`);
                log(`üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${data.users.totalUsers}`);
                log(`‚úÖ –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö: ${data.users.verified}`);
                log(`‚è≥ –û–∂–∏–¥–∞—é—Ç –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏: ${data.users.pending}`);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º JSON
                const jsonViewer = document.createElement('div');
                jsonViewer.className = 'json-viewer';
                jsonViewer.textContent = JSON.stringify(data, null, 2);
                document.getElementById('test-content').appendChild(jsonViewer);
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'test-content');
            }
        }
        
        async function loadUsers() {
            try {
                clearLog('users-content');
                log('üë• –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...', 'users-content');
                
                const response = await fetch(`${RAILWAY_URL}/api/users`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const users = await response.json();
                
                log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${users.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`, 'users-content');
                
                // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
                let table = `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>–ò–º—è</th>
                                <th>Email</th>
                                <th>–†–æ–ª—å</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                users.forEach(user => {
                    const status = user.verified ? 
                        '<span style="color: green;">‚úì –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω</span>' : 
                        '<span style="color: orange;">‚è≥ –û–∂–∏–¥–∞–µ—Ç</span>';
                    
                    table += `
                        <tr>
                            <td>${user.id}</td>
                            <td>${user.name}</td>
                            <td>${user.email}</td>
                            <td>${user.role}</td>
                            <td>${status}</td>
                            <td>${new Date(user.created_at).toLocaleDateString()}</td>
                        </tr>
                    `;
                });
                
                table += '</tbody></table>';
                
                document.getElementById('users-content').innerHTML = table;
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'users-content');
            }
        }
        
        async function loadMenu() {
            try {
                clearLog('menu-content');
                log('üçΩÔ∏è –ó–∞–≥—Ä—É–∂–∞–µ–º –º–µ–Ω—é...', 'menu-content');
                
                const response = await fetch(`${RAILWAY_URL}/api/menu`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const menu = await response.json();
                
                log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${menu.length} –±–ª—é–¥`, 'menu-content');
                
                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –ø–∏—Ç–∞–Ω–∏—è
                const breakfast = menu.filter(d => d.meal_type === '–∑–∞–≤—Ç—Ä–∞–∫').length;
                const lunch = menu.filter(d => d.meal_type === '–æ–±–µ–¥').length;
                const snack = menu.filter(d => d.meal_type === '–ø–æ–ª–¥–Ω–∏–∫').length;
                
                log(`üç≥ –ó–∞–≤—Ç—Ä–∞–∫: ${breakfast} –±–ª—é–¥`, 'menu-content');
                log(`üçΩÔ∏è –û–±–µ–¥: ${lunch} –±–ª—é–¥`, 'menu-content');
                log(`üç™ –ü–æ–ª–¥–Ω–∏–∫: ${snack} –±–ª—é–¥`, 'menu-content');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 10 –±–ª—é–¥
                if (menu.length > 0) {
                    let table = `
                        <h3>–ü–µ—Ä–≤—ã–µ 10 –±–ª—é–¥:</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                    <th>–¢–∏–ø –ø–∏—Ç–∞–Ω–∏—è</th>
                                    <th>–î–µ–Ω—å –Ω–µ–¥–µ–ª–∏</th>
                                    <th>–í–µ—Å</th>
                                    <th>–†–µ—Ü–µ–ø—Ç</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    
                    menu.slice(0, 10).forEach(dish => {
                        table += `
                            <tr>
                                <td>${dish.id}</td>
                                <td>${dish.name}</td>
                                <td>${dish.meal_type}</td>
                                <td>${dish.day_of_week}</td>
                                <td>${dish.weight || 'N/A'}</td>
                                <td>${dish.recipe_number || 'N/A'}</td>
                            </tr>
                        `;
                    });
                    
                    table += '</tbody></table>';
                    
                    document.getElementById('menu-content').innerHTML += table;
                }
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'menu-content');
            }
        }
        
        async function testUserVerification() {
            try {
                clearLog();
                log('‚úÖ –¢–µ—Å—Ç–∏—Ä—É–µ–º –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...');
                
                // –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å ID 462
                const response = await fetch(`${RAILWAY_URL}/api/users/462/verify`, {
                    method: 'POST'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                
                log('‚úÖ –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!');
                log(`üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${result.user.name}`);
                log(`üìß Email: ${result.user.email}`);
                log(`‚úÖ –°—Ç–∞—Ç—É—Å: ${result.user.verified ? '–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω' : '–ù–µ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω'}`);
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏: ${error.message}`);
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            loadFullDatabase();
        };
    </script>
</body>
</html>
