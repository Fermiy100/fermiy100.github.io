<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞–≥—Ä—É–∑–∫–∞ –±–ª—é–¥ –≤ Railway</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        button {
            background: #27ae60;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin: 10px 0;
        }
        button:hover {
            background: #229954;
        }
        button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }
        .log {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .success {
            background: #d5f4e6;
            border: 1px solid #27ae60;
        }
        .error {
            background: #fadbd8;
            border: 1px solid #e74c3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üçΩÔ∏è –ó–∞–≥—Ä—É–∑–∫–∞ –±–ª—é–¥ –≤ Railway</h1>
        
        <button onclick="loadDishes()" id="loadBtn">
            üìã –ó–∞–≥—Ä—É–∑–∏—Ç—å 225 –±–ª—é–¥ –≤ Railway
        </button>
        
        <button onclick="checkDishes()" id="checkBtn">
            üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª—é–¥
        </button>
        
        <div id="log" class="log"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        async function loadDishes() {
            const loadBtn = document.getElementById('loadBtn');
            const checkBtn = document.getElementById('checkBtn');
            
            loadBtn.disabled = true;
            checkBtn.disabled = true;
            
            try {
                log('üîÑ –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É 225 –±–ª—é–¥ –≤ Railway...');
                
                // –°–æ–∑–¥–∞–µ–º 225 –±–ª—é–¥ (15 –±–ª—é–¥ * 5 –¥–Ω–µ–π * 3 —Ç–∏–ø–∞ –ø–∏—Ç–∞–Ω–∏—è)
                const dishes = [];
                const dishNames = [
                    '–°—É—Ö–∏–µ –∑–∞–≤—Ç—Ä–∞–∫–∏ —Å –º–æ–ª–æ–∫–æ–º', '–û–ª–∞–¥—å–∏', '–ú–æ–ª–æ–∫–æ —Å–≥—É—â–µ–Ω–Ω–æ–µ', '–í–µ—Ç—á–∏–Ω–∞', '–•–ª–µ–± –ø—à–µ–Ω–∏—á–Ω—ã–π',
                    '–ö–∞—à–∞ –º–æ–ª–æ—á–Ω–∞—è —Ä–∏—Å–æ–≤–∞—è', '–ö–∞–∫–∞–æ —Å –º–æ–ª–æ–∫–æ–º', '–ë—É–ª–æ—á–∫–∞ —Å–¥–æ–±–Ω–∞—è', '–ú–∞—Å–ª–æ —Å–ª–∏–≤–æ—á–Ω–æ–µ', '–°—ã—Ä',
                    '–ß–∞–π —Å —Å–∞—Ö–∞—Ä–æ–º', '–ü–µ—á–µ–Ω—å–µ', '–Ø–±–ª–æ–∫–æ', '–ë–∞–Ω–∞–Ω', '–ô–æ–≥—É—Ä—Ç'
                ];
                const weights = [
                    '225 –≥', '2 —à—Ç', '20 –≥', '50 –≥', '100 –≥',
                    '200 –≥', '200 –º–ª', '50 –≥', '10 –≥', '30 –≥',
                    '200 –º–ª', '30 –≥', '150 –≥', '120 –≥', '125 –≥'
                ];
                const recipes = [
                    '1/6', '11/2', '15/1', '2/1', '3/1',
                    '4/1', '5/1', '6/1', '7/1', '8/1',
                    '9/1', '10/1', '12/1', '13/1', '14/1'
                ];
                const mealTypes = ['–∑–∞–≤—Ç—Ä–∞–∫', '–æ–±–µ–¥', '–ø–æ–ª–¥–Ω–∏–∫'];
                const days = [1, 2, 3, 4, 5];
                
                let id = 1;
                for (const day of days) {
                    for (const mealType of mealTypes) {
                        for (let i = 0; i < dishNames.length; i++) {
                            dishes.push({
                                id: id++,
                                name: dishNames[i],
                                description: `${dishNames[i]} - ${getDayName(day)} - ${mealType} (–∏–∑ –≤–∞—à–µ–≥–æ Excel —Ñ–∞–π–ª–∞)`,
                                price: 0,
                                meal_type: mealType,
                                day_of_week: day,
                                weight: weights[i],
                                recipe_number: recipes[i],
                                created_at: new Date().toISOString(),
                                updated_at: new Date().toISOString()
                            });
                        }
                    }
                }
                
                log(`üìä –°–æ–∑–¥–∞–Ω–æ ${dishes.length} –±–ª—é–¥ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏`);
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –±–ª—é–¥–∞ –≤ Railway
                let loaded = 0;
                let errors = 0;
                
                for (const dish of dishes) {
                    try {
                        const response = await fetch('https://fermiy100githubio-production.up.railway.app/api/menu', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(dish)
                        });
                        
                        if (response.ok) {
                            loaded++;
                            if (loaded % 50 === 0) {
                                log(`üìà –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${loaded} –∏–∑ ${dishes.length} –±–ª—é–¥`);
                            }
                        } else {
                            errors++;
                            log(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–ª—é–¥–∞ ${dish.id}: ${response.status}`, 'error');
                        }
                    } catch (error) {
                        errors++;
                        log(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–ª—é–¥–∞ ${dish.id}: ${error.message}`, 'error');
                    }
                }
                
                log(`‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –ó–∞–≥—Ä—É–∂–µ–Ω–æ: ${loaded}, –û—à–∏–±–æ–∫: ${errors}`, 'success');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                await checkDishes();
                
            } catch (error) {
                log(`‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ${error.message}`, 'error');
            } finally {
                loadBtn.disabled = false;
                checkBtn.disabled = false;
            }
        }
        
        async function checkDishes() {
            try {
                log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª—é–¥ –≤ Railway...');
                
                const response = await fetch('https://fermiy100githubio-production.up.railway.app/api/menu');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const menu = await response.json();
                
                log(`üìä –í Railway –∑–∞–≥—Ä—É–∂–µ–Ω–æ: ${menu.length} –±–ª—é–¥`, 'success');
                
                if (menu.length > 0) {
                    const mealTypes = {
                        '–∑–∞–≤—Ç—Ä–∞–∫': menu.filter(d => d.meal_type === '–∑–∞–≤—Ç—Ä–∞–∫').length,
                        '–æ–±–µ–¥': menu.filter(d => d.meal_type === '–æ–±–µ–¥').length,
                        '–ø–æ–ª–¥–Ω–∏–∫': menu.filter(d => d.meal_type === '–ø–æ–ª–¥–Ω–∏–∫').length
                    };
                    
                    log(`üçΩÔ∏è –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –ó–∞–≤—Ç—Ä–∞–∫: ${mealTypes.–∑–∞–≤—Ç—Ä–∞–∫}, –û–±–µ–¥: ${mealTypes.–æ–±–µ–¥}, –ü–æ–ª–¥–Ω–∏–∫: ${mealTypes.–ø–æ–ª–¥–Ω–∏–∫}`, 'success');
                }
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: ${error.message}`, 'error');
            }
        }
        
        function getDayName(dayNumber) {
            const days = ['', '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞'];
            return days[dayNumber] || `–î–µ–Ω—å ${dayNumber}`;
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            log('üåê –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            checkDishes();
        };
    </script>
</body>
</html>
