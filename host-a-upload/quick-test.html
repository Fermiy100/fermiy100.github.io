<!DOCTYPE html>
<html>
<head>
    <title>Quick Menu Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .upload-area { border: 2px dashed #ddd; padding: 40px; text-align: center; margin: 20px 0; }
        .result { margin: 20px 0; padding: 15px; border-radius: 5px; }
        .success { background: #e8f5e8; border: 1px solid #4caf50; }
        .error { background: #ffebee; border: 1px solid #f44336; }
        .dish-item { background: #f5f5f5; margin: 5px 0; padding: 10px; border-radius: 3px; }
        .meal-section { margin: 20px 0; }
        .meal-title { font-weight: bold; color: #333; font-size: 18px; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üçΩÔ∏è –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–Ω—é</h1>
        
        <div class="upload-area">
            <h3>–ó–∞–≥—Ä—É–∑–∏—Ç—å Excel —Ñ–∞–π–ª</h3>
            <input type="file" id="fileInput" accept=".xlsx,.xls">
            <br><br>
            <button onclick="uploadFile()" style="padding: 10px 20px; font-size: 16px;">–ó–∞–≥—Ä—É–∑–∏—Ç—å –º–µ–Ω—é</button>
        </div>
        
        <div id="result"></div>
        <div id="menuDisplay"></div>
    </div>

    <script>
        async function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showResult('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª Excel', 'error');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', file);
            
            try {
                showResult('‚è≥ –ó–∞–≥—Ä—É–∂–∞–µ–º –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –º–µ–Ω—é...', 'success');
                
                const response = await fetch('/api/menu/upload-simple.php', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showResult(`‚úÖ ${data.message}<br>
                        üìä –î–æ–±–∞–≤–ª–µ–Ω–æ –±–ª—é–¥: ${data.addedCount}<br>
                        üìÑ –§–∞–π–ª: ${data.filename}<br>
                        üç≥ –ó–∞–≤—Ç—Ä–∞–∫–∏: ${data.analysis.breakfast_items}<br>
                        üçΩÔ∏è –û–±–µ–¥—ã: ${data.analysis.lunch_items}<br>
                        ü•õ –ü–æ–ª–¥–Ω–∏–∫–∏: ${data.analysis.snack_items}`, 'success');
                    
                    displayMenu(data.dishes);
                } else {
                    showResult(`‚ùå –û—à–∏–±–∫–∞: ${data.error}`, 'error');
                }
                
            } catch (error) {
                showResult(`üí• –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }
        
        function showResult(message, type) {
            document.getElementById('result').innerHTML = `<div class="result ${type}">${message}</div>`;
        }
        
        function displayMenu(dishes) {
            const mealTypes = {
                '–∑–∞–≤—Ç—Ä–∞–∫': 'üåÖ –ó–∞–≤—Ç—Ä–∞–∫',
                '–æ–±–µ–¥': 'üçΩÔ∏è –û–±–µ–¥', 
                '–ø–æ–ª–¥–Ω–∏–∫': 'ü•õ –ü–æ–ª–¥–Ω–∏–∫'
            };
            
            const grouped = {};
            dishes.forEach(dish => {
                if (!grouped[dish.meal_type]) grouped[dish.meal_type] = [];
                grouped[dish.meal_type].push(dish);
            });
            
            let html = '<h2>üìã –ó–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ –º–µ–Ω—é</h2>';
            
            Object.keys(mealTypes).forEach(mealType => {
                if (grouped[mealType]) {
                    html += `<div class="meal-section">
                        <div class="meal-title">${mealTypes[mealType]} (${grouped[mealType].length} –±–ª—é–¥)</div>`;
                    
                    grouped[mealType].forEach(dish => {
                        html += `<div class="dish-item">
                            <strong>${dish.name}</strong> - ${dish.price}‚ÇΩ (${dish.weight})<br>
                            <small>üìù ${dish.description} | üè∑Ô∏è ${dish.recipe_number}</small>
                        </div>`;
                    });
                    
                    html += '</div>';
                }
            });
            
            document.getElementById('menuDisplay').innerHTML = html;
        }
    </script>
</body>
</html>
