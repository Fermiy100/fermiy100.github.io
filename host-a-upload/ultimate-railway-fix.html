<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Railway Fix - –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –∏–¥–µ–∞–ª–∞</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .container { max-width: 1000px; margin: 0 auto; background: rgba(255,255,255,0.1); padding: 30px; border-radius: 15px; backdrop-filter: blur(10px); }
        .success { color: #4ade80; font-weight: bold; }
        .error { color: #f87171; font-weight: bold; }
        .warning { color: #fbbf24; font-weight: bold; }
        .info { color: #60a5fa; font-weight: bold; }
        button { padding: 15px 25px; margin: 10px; font-size: 16px; border: none; border-radius: 8px; cursor: pointer; transition: all 0.3s; }
        .btn-primary { background: #3b82f6; color: white; }
        .btn-primary:hover { background: #2563eb; transform: translateY(-2px); }
        .btn-danger { background: #ef4444; color: white; }
        .btn-danger:hover { background: #dc2626; transform: translateY(-2px); }
        .btn-success { background: #10b981; color: white; }
        .btn-success:hover { background: #059669; transform: translateY(-2px); }
        .btn-warning { background: #f59e0b; color: white; }
        .btn-warning:hover { background: #d97706; transform: translateY(-2px); }
        pre { background: rgba(0,0,0,0.3); padding: 20px; border-radius: 10px; overflow-x: auto; border: 1px solid rgba(255,255,255,0.2); }
        .step { margin: 25px 0; padding: 20px; border-left: 5px solid #3b82f6; background: rgba(255,255,255,0.05); border-radius: 10px; }
        .progress { background: rgba(255,255,255,0.2); border-radius: 10px; padding: 10px; margin: 10px 0; }
        .progress-bar { background: #10b981; height: 20px; border-radius: 10px; transition: width 0.3s; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Ultimate Railway Fix - –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –∏–¥–µ–∞–ª–∞</h1>
        
        <div class="step">
            <h2>üéØ –¶–µ–ª—å: –ò–¥–µ–∞–ª—å–Ω—ã–π Railway</h2>
            <p>–î–æ–±–∏—Ç—å—Å—è –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è Railway —Å –≤–µ—Ä—Å–∏–µ–π v5.0.0, UTF-8 –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π –∏ –≤—Å–µ–º–∏ 75 –±–ª—é–¥–∞–º–∏ –∏–∑ Excel —Ñ–∞–π–ª–∞.</p>
        </div>
        
        <div class="step">
            <h2>üîß –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π</h2>
            <p>–ü–æ—à–∞–≥–æ–≤–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è Railway.</p>
            
            <button class="btn-primary" onclick="checkCurrentState()">1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</button>
            <button class="btn-danger" onclick="clearAllData()">2. –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
            <button class="btn-warning" onclick="addAll75Dishes()">3. –î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ 75 –±–ª—é–¥</button>
            <button class="btn-success" onclick="verifyPerfectState()">4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–¥–µ–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</button>
        </div>
        
        <div class="progress" id="progress" style="display: none;">
            <div class="progress-bar" id="progressBar" style="width: 0%;"></div>
            <div id="progressText">–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ</div>
        </div>
        
        <div id="results"></div>
    </div>

    <script>
        let addedDishes = 0;
        const totalDishes = 75;

        async function checkCurrentState() {
            const div = document.getElementById('results');
            div.innerHTML = '<div class="info">üîç –ü—Ä–æ–≤–µ—Ä—è—é —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ Railway...</div>';
            
            try {
                const response = await fetch('https://fermiy100githubio-production.up.railway.app/');
                const data = await response.json();
                
                const menuResponse = await fetch('https://fermiy100githubio-production.up.railway.app/api/menu');
                const menuData = await menuResponse.json();
                
                const isUpdated = data.message && data.message.includes('v5.0.0');
                const hasCorrectEncoding = menuData.length > 0 && !menuData[0].name.includes('?');
                const hasAllDishes = menuData.length === 75;
                
                let statusHtml = '';
                if (isUpdated) {
                    statusHtml += '<div class="success">‚úÖ Railway –æ–±–Ω–æ–≤–ª–µ–Ω –¥–æ v5.0.0!</div>';
                } else {
                    statusHtml += '<div class="error">‚ùå Railway –ù–ï –æ–±–Ω–æ–≤–ª–µ–Ω –¥–æ v5.0.0</div>';
                }
                
                if (hasCorrectEncoding) {
                    statusHtml += '<div class="success">‚úÖ –ö–æ–¥–∏—Ä–æ–≤–∫–∞ UTF-8 —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!</div>';
                } else {
                    statusHtml += '<div class="error">‚ùå –ü—Ä–æ–±–ª–µ–º–∞ —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π UTF-8</div>';
                }
                
                if (hasAllDishes) {
                    statusHtml += '<div class="success">‚úÖ –í—Å–µ 75 –±–ª—é–¥ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!</div>';
                } else {
                    statusHtml += `<div class="warning">‚ö†Ô∏è –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${menuData.length}/75 –±–ª—é–¥</div>`;
                }
                
                div.innerHTML = `
                    <h3>üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ Railway:</h3>
                    ${statusHtml}
                    <div>üìä –°–æ–æ–±—â–µ–Ω–∏–µ: ${data.message}</div>
                    <div>üçΩÔ∏è –ë–ª—é–¥: ${menuData.length}</div>
                    <div>‚è∞ –í—Ä–µ–º—è: ${data.time}</div>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                div.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>`;
            }
        }

        async function clearAllData() {
            const div = document.getElementById('results');
            div.innerHTML = '<div class="warning">üóëÔ∏è –û—á–∏—â–∞—é –≤—Å–µ –¥–∞–Ω–Ω—ã–µ Railway...</div>';
            
            try {
                const response = await fetch('https://fermiy100githubio-production.up.railway.app/api/menu/clear', {
                    method: 'DELETE'
                });
                const data = await response.json();
                
                div.innerHTML = `
                    <div class="success">‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã!</div>
                    <div>üóëÔ∏è –†–µ–∑—É–ª—å—Ç–∞—Ç: ${JSON.stringify(data, null, 2)}</div>
                `;
            } catch (error) {
                div.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ: ${error.message}</div>`;
            }
        }

        async function addAll75Dishes() {
            const div = document.getElementById('results');
            const progressDiv = document.getElementById('progress');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            
            progressDiv.style.display = 'block';
            div.innerHTML = '<div class="info">‚ûï –î–æ–±–∞–≤–ª—è—é –≤—Å–µ 75 –±–ª—é–¥ –∏–∑ Excel —Ñ–∞–π–ª–∞...</div>';
            
            const exactDishes = [
                '–°—É—Ö–∏–µ –∑–∞–≤—Ç—Ä–∞–∫–∏ —Å –º–æ–ª–æ–∫–æ–º', '–û–ª–∞–¥—å–∏', '–ú–æ–ª–æ–∫–æ —Å–≥—É—â–µ–Ω–Ω–æ–µ', '–°–º–µ—Ç–∞–Ω–∞',
                '–î–∂–µ–º —Ñ—Ä—É–∫—Ç–æ–≤—ã–π', '–ú–µ–¥', '–ú–∞—Å–ª–æ —Å–ª–∏–≤–æ—á–Ω–æ–µ', '–°—ã—Ä', '–ö–æ–ª–±–∞—Å–∞ –≤–∞—Ä–µ–Ω–∞—è',
                '–ö–æ–ª–±–∞—Å–∞ –≤/–∫', '–í–µ—Ç—á–∏–Ω–∞', '–•–ª–µ–± –∏–∑ –ø—à–µ–Ω–∏—á–Ω–æ–π –º—É–∫–∏', '–ß–∞–π —Å —Å–∞—Ö–∞—Ä–æ–º',
                '–ß–∞–π —Å –º–æ–ª–æ–∫–æ–º', '–ö–∞–∫–∞–æ —Å –º–æ–ª–æ–∫–æ–º'
            ];

            const exactWeights = [
                '225 –≥', '2 —à—Ç', '20 –≥', '20 –≥', '20 –≥', '20 –≥', '10 –≥', '15 –≥', 
                '20 –≥', '20 –≥', '20 –≥', '20 –≥', '200 –≥', '200 –≥', '200 –≥'
            ];

            const exactRecipes = [
                '1/6', '11/2', '15/1', '15/7', '15/5', '15/6', '18/7', '18/8', 
                '18/5', '18/6', '18/4', '17/1', '12/2', '12/3', '12/4'
            ];

            addedDishes = 0;
            
            try {
                // –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ 75 –±–ª—é–¥ (15 –±–ª—é–¥ √ó 5 –¥–Ω–µ–π)
                for (let day = 1; day <= 5; day++) {
                    for (let i = 0; i < exactDishes.length; i++) {
                        const dish = {
                            name: exactDishes[i],
                            description: `–¢–æ—á–Ω–æ–µ –±–ª—é–¥–æ –∏–∑ Excel —Ñ–∞–π–ª–∞ (–¥–µ–Ω—å ${day})`,
                            price: 0,
                            meal_type: '–∑–∞–≤—Ç—Ä–∞–∫',
                            day_of_week: day,
                            weight: exactWeights[i],
                            recipe_number: exactRecipes[i]
                        };
                        
                        await fetch('https://fermiy100githubio-production.up.railway.app/api/menu', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(dish)
                        });
                        
                        addedDishes++;
                        const progress = (addedDishes / totalDishes) * 100;
                        progressBar.style.width = progress + '%';
                        progressText.textContent = `–î–æ–±–∞–≤–ª–µ–Ω–æ ${addedDishes}/75 –±–ª—é–¥ (${Math.round(progress)}%)`;
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 –±–ª—é–¥
                        if (addedDishes % 5 === 0) {
                            div.innerHTML = `
                                <div class="info">‚ûï –î–æ–±–∞–≤–ª—è—é –≤—Å–µ 75 –±–ª—é–¥ –∏–∑ Excel —Ñ–∞–π–ª–∞...</div>
                                <div class="success">‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ ${addedDishes}/75 –±–ª—é–¥</div>
                                <div>üìÖ –î–µ–Ω—å ${day}, –±–ª—é–¥–æ ${i + 1}/15: ${exactDishes[i]}</div>
                            `;
                        }
                    }
                }
                
                div.innerHTML = `
                    <div class="success">üéâ –í—Å–µ 75 –±–ª—é–¥ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã!</div>
                    <div>‚úÖ 15 –±–ª—é–¥ √ó 5 –¥–Ω–µ–π = 75 –±–ª—é–¥</div>
                    <div>üìä –ü—Ä–æ–≥—Ä–µ—Å—Å: 100%</div>
                `;
                
            } catch (error) {
                div.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –±–ª—é–¥: ${error.message}</div>`;
            }
        }

        async function verifyPerfectState() {
            const div = document.getElementById('results');
            div.innerHTML = '<div class="info">üîç –ü—Ä–æ–≤–µ—Ä—è—é –∏–¥–µ–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ Railway...</div>';
            
            try {
                const response = await fetch('https://fermiy100githubio-production.up.railway.app/');
                const data = await response.json();
                
                const menuResponse = await fetch('https://fermiy100githubio-production.up.railway.app/api/menu');
                const menuData = await menuResponse.json();
                
                const isUpdated = data.message && data.message.includes('v5.0.0');
                const hasCorrectEncoding = menuData.length > 0 && !menuData[0].name.includes('?');
                const hasAllDishes = menuData.length === 75;
                
                let statusHtml = '';
                if (isUpdated && hasCorrectEncoding && hasAllDishes) {
                    statusHtml = '<div class="success">üéâ –ò–î–ï–ê–õ–¨–ù–û–ï –°–û–°–¢–û–Ø–ù–ò–ï –î–û–°–¢–ò–ì–ù–£–¢–û!</div>';
                } else {
                    statusHtml = '<div class="error">‚ùå –ò–¥–µ–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ</div>';
                }
                
                if (isUpdated) {
                    statusHtml += '<div class="success">‚úÖ Railway –æ–±–Ω–æ–≤–ª–µ–Ω –¥–æ v5.0.0!</div>';
                } else {
                    statusHtml += '<div class="error">‚ùå Railway –ù–ï –æ–±–Ω–æ–≤–ª–µ–Ω –¥–æ v5.0.0</div>';
                }
                
                if (hasCorrectEncoding) {
                    statusHtml += '<div class="success">‚úÖ –ö–æ–¥–∏—Ä–æ–≤–∫–∞ UTF-8 —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!</div>';
                } else {
                    statusHtml += '<div class="error">‚ùå –ü—Ä–æ–±–ª–µ–º–∞ —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π UTF-8</div>';
                }
                
                if (hasAllDishes) {
                    statusHtml += '<div class="success">‚úÖ –í—Å–µ 75 –±–ª—é–¥ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!</div>';
                } else {
                    statusHtml += `<div class="warning">‚ö†Ô∏è –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${menuData.length}/75 –±–ª—é–¥</div>`;
                }
                
                div.innerHTML = `
                    <h3>üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è:</h3>
                    ${statusHtml}
                    <div>üìä –°–æ–æ–±—â–µ–Ω–∏–µ: ${data.message}</div>
                    <div>üçΩÔ∏è –ë–ª—é–¥: ${menuData.length}</div>
                    <div>‚è∞ –í—Ä–µ–º—è: ${data.time}</div>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
                
            } catch (error) {
                div.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ: ${error.message}</div>`;
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            checkCurrentState();
        };
    </script>
</body>
</html>
