<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçΩÔ∏è –ü–∞—Ä—Å–µ—Ä Excel –º–µ–Ω—é v2.0</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .upload-section {
            padding: 40px;
            text-align: center;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            margin: 20px 0;
        }

        .file-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-input-button {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .file-input-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
            display: none;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #059669);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            color: #6b7280;
            font-weight: 500;
        }

        .message {
            padding: 15px 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: 500;
            display: none;
        }

        .message.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .message.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        .message.info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }

        .menu-card {
            display: none;
            margin-top: 30px;
            padding: 30px;
            background: #f8fafc;
            border-radius: 15px;
            border: 1px solid #e2e8f0;
        }

        .menu-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 10px;
            text-align: center;
        }

        .menu-count {
            text-align: center;
            color: #64748b;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .day-section {
            margin-bottom: 30px;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .day-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #1e293b;
        }

        .meal-count {
            background: #3b82f6;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .meal-type {
            margin-bottom: 20px;
        }

        .meal-type-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 10px;
            padding: 8px 15px;
            background: #f3f4f6;
            border-radius: 8px;
            border-left: 4px solid #10b981;
        }

        .meals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }

        .meal-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #e5e7eb;
            transition: all 0.3s ease;
        }

        .meal-item:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        .meal-name {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 5px;
            font-size: 1rem;
        }

        .meal-description {
            color: #64748b;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .meal-price {
            color: #059669;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .export-section {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 12px;
        }

        .export-button {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 0 10px;
            transition: all 0.3s ease;
        }

        .export-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(139, 92, 246, 0.3);
        }

        .json-output {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçΩÔ∏è –ü–∞—Ä—Å–µ—Ä Excel –º–µ–Ω—é v2.0</h1>
            <p>–£–º–Ω—ã–π –ø–∞—Ä—Å–µ—Ä –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–µ–Ω—é —Å –ø–∞—Ä–∞–º–∏ —Å—Ç–æ–ª–±—Ü–æ–≤</p>
        </div>

        <div class="upload-section">
            <div class="file-input-wrapper">
                <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls" />
                <button class="file-input-button">
                    üìÅ –í—ã–±–µ—Ä–∏—Ç–µ Excel —Ñ–∞–π–ª
                </button>
            </div>

            <div class="progress-bar" id="progressBar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText"></div>

            <div id="message" class="message"></div>

            <div class="menu-card" id="menuCard">
                <div class="menu-title" id="menuTitle"></div>
                <div class="menu-count" id="menuCount"></div>
                <div id="menuGrid"></div>

                <div class="export-section">
                    <button class="export-button" onclick="exportToJSON()">üìÑ –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON</button>
                    <button class="export-button" onclick="exportToCSV()">üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</button>
                    <div class="json-output" id="jsonOutput"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedFile = null;
        let parsedMenu = null;

        const dayNames = ["", "–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", "–í—Ç–æ—Ä–Ω–∏–∫", "–°—Ä–µ–¥–∞", "–ß–µ—Ç–≤–µ—Ä–≥", "–ü—è—Ç–Ω–∏—Ü–∞", "–°—É–±–±–æ—Ç–∞", "–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ"];
        const mealTypes = ["–∑–∞–≤—Ç—Ä–∞–∫", "–æ–±–µ–¥", "–ø–æ–ª–¥–Ω–∏–∫"];

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            selectedFile = file;
            document.querySelector('.file-input-button').textContent = `üìÅ ${file.name}`;
            showMessage(`–§–∞–π–ª –≤—ã–±—Ä–∞–Ω: ${file.name}`, 'info');
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –∫–Ω–æ–ø–∫—É
        document.querySelector('.file-input-button').addEventListener('click', function() {
            if (selectedFile) {
                processFile();
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞
        async function processFile() {
            if (!selectedFile) {
                showMessage('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª', 'error');
                return;
            }

            try {
                showProgress(true);
                setProgress(10, '–ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞...');

                const data = await readFile(selectedFile);
                const workbook = XLSX.read(data, { type: 'array' });
                
                setProgress(30, '–ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã...');
                
                // –ò—â–µ–º –ª–∏—Å—Ç —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º —Å–æ–¥–µ—Ä–∂–∞—â–∏–º "–ù–ï–î–ï–õ–Ø"
                let targetSheet = null;
                for (const sheetName of workbook.SheetNames) {
                    if (sheetName.toLowerCase().includes('–Ω–µ–¥–µ–ª')) {
                        targetSheet = sheetName;
                        break;
                    }
                }

                if (!targetSheet) {
                    targetSheet = workbook.SheetNames[0];
                }

                const worksheet = workbook.Sheets[targetSheet];
                const jsonData = XLSX.utils.sheet_to_json(worksheet, { 
                    header: 1, 
                    raw: false,
                    defval: ''
                });

                setProgress(60, '–ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã...');
                
                const menu = parseStructuredMenu(jsonData, targetSheet);
                
                setProgress(100, '–ì–æ—Ç–æ–≤–æ!');
                
                parsedMenu = menu;
                displayMenu(menu);
                showMessage(`‚úÖ –ú–µ–Ω—é —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–æ! –ù–∞–π–¥–µ–Ω–æ ${menu.totalDishes} –±–ª—é–¥`, 'success');

            } catch (error) {
                showMessage('‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞: ' + error.message, 'error');
                console.error('–û—à–∏–±–∫–∞:', error);
            } finally {
                showProgress(false);
            }
        }

        // –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
        function readFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = (e) => reject(e);
                reader.readAsArrayBuffer(file);
            });
        }

        // –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –º–µ–Ω—é
        function parseStructuredMenu(jsonData, sheetName) {
            const menu = {
                –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫: { –ó–∞–≤—Ç—Ä–∞–∫: [], –û–±–µ–¥: [], –ü–æ–ª–¥–Ω–∏–∫: [] },
                –í—Ç–æ—Ä–Ω–∏–∫: { –ó–∞–≤—Ç—Ä–∞–∫: [], –û–±–µ–¥: [], –ü–æ–ª–¥–Ω–∏–∫: [] },
                –°—Ä–µ–¥–∞: { –ó–∞–≤—Ç—Ä–∞–∫: [], –û–±–µ–¥: [], –ü–æ–ª–¥–Ω–∏–∫: [] },
                –ß–µ—Ç–≤–µ—Ä–≥: { –ó–∞–≤—Ç—Ä–∞–∫: [], –û–±–µ–¥: [], –ü–æ–ª–¥–Ω–∏–∫: [] },
                –ü—è—Ç–Ω–∏—Ü–∞: { –ó–∞–≤—Ç—Ä–∞–∫: [], –û–±–µ–¥: [], –ü–æ–ª–¥–Ω–∏–∫: [] }
            };

            let totalDishes = 0;

            // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É - –∏—â–µ–º –ø–∞—Ä—ã —Å—Ç–æ–ª–±—Ü–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è
            const dayColumns = findDayColumns(jsonData);
            
            console.log('–ù–∞–π–¥–µ–Ω–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã –¥–Ω–µ–π:', dayColumns);

            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
            for (const [dayName, columns] of Object.entries(dayColumns)) {
                const dayData = parseDayData(jsonData, columns);
                menu[dayName] = dayData;
                totalDishes += Object.values(dayData).flat().length;
            }

            // –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–µ–¥–µ–ª–µ
            const weekMatch = sheetName.match(/(\d+)\s*–Ω–µ–¥–µ–ª/i);
            const week = weekMatch ? `–ù–µ–¥–µ–ª—è ${weekMatch[1]}` : '–¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è';

            return {
                menu,
                week,
                title: `–ú–µ–Ω—é –Ω–∞ ${week}`,
                totalDishes,
                sheetName
            };
        }

        // –ü–æ–∏—Å–∫ —Å—Ç–æ–ª–±—Ü–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è
        function findDayColumns(jsonData) {
            const dayColumns = {};
            const dayNames = ['–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞'];

            // –ò—â–µ–º –≤ –ø–µ—Ä–≤—ã—Ö 3 —Å—Ç—Ä–æ–∫–∞—Ö –Ω–∞–∑–≤–∞–Ω–∏—è –¥–Ω–µ–π
            for (let rowIndex = 0; rowIndex < Math.min(3, jsonData.length); rowIndex++) {
                const row = jsonData[rowIndex];
                if (!row) continue;

                for (let colIndex = 0; colIndex < row.length; colIndex++) {
                    const cellValue = (row[colIndex] || '').toString().trim();
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ —è—á–µ–π–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–Ω—è
                    for (const dayName of dayNames) {
                        if (cellValue.toLowerCase().includes(dayName.toLowerCase())) {
                            // –ù–∞–π–¥–µ–Ω –¥–µ–Ω—å, –∏—â–µ–º –ø–∞—Ä—É —Å—Ç–æ–ª–±—Ü–æ–≤
                            const dayCols = findDayColumnPair(jsonData, colIndex);
                            if (dayCols.length >= 1) {
                                dayColumns[dayName] = dayCols;
                            }
                            break;
                        }
                    }
                }
            }

            return dayColumns;
        }

        // –ü–æ–∏—Å–∫ –ø–∞—Ä—ã —Å—Ç–æ–ª–±—Ü–æ–≤ –¥–ª—è –¥–Ω—è
        function findDayColumnPair(jsonData, startCol) {
            const columns = [];
            
            // –ò—â–µ–º —Å—Ç–æ–ª–±—Ü—ã —Å –¥–∞–Ω–Ω—ã–º–∏ (–Ω–µ –ø—É—Å—Ç—ã–µ)
            for (let col = startCol; col < startCol + 4; col++) {
                let hasData = false;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö
                for (let row = 0; row < Math.min(20, jsonData.length); row++) {
                    const cellValue = (jsonData[row] && jsonData[row][col]) ? 
                        jsonData[row][col].toString().trim() : '';
                    
                    if (cellValue && cellValue.length > 2 && !isServiceCell(cellValue)) {
                        hasData = true;
                        break;
                    }
                }
                
                if (hasData) {
                    columns.push(col);
                }
            }
            
            return columns;
        }

        // –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö –¥–Ω—è
        function parseDayData(jsonData, columns) {
            const dayData = { –ó–∞–≤—Ç—Ä–∞–∫: [], –û–±–µ–¥: [], –ü–æ–ª–¥–Ω–∏–∫: [] };
            let currentMealType = '–ó–∞–≤—Ç—Ä–∞–∫';

            // –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ —Å—Ç—Ä–æ–∫–∞–º –∏ –∏—â–µ–º —Å–µ–∫—Ü–∏–∏ –ø–∏—Ç–∞–Ω–∏—è
            for (let rowIndex = 0; rowIndex < jsonData.length; rowIndex++) {
                const row = jsonData[rowIndex];
                if (!row) continue;

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–≤—É—é —è—á–µ–π–∫—É –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
                const firstCell = (row[0] || '').toString().trim().toLowerCase();
                
                if (firstCell.includes('–∑–∞–≤—Ç—Ä–∞–∫') || firstCell.includes('–∑  –∞  –≤  —Ç  —Ä  –∞  –∫')) {
                    currentMealType = '–ó–∞–≤—Ç—Ä–∞–∫';
                    continue;
                } else if (firstCell.includes('–æ–±–µ–¥') || firstCell.includes('–æ  –±  –µ  –¥')) {
                    currentMealType = '–û–±–µ–¥';
                    continue;
                } else if (firstCell.includes('–ø–æ–ª–¥–Ω–∏–∫') || firstCell.includes('–ø  –æ  –ª  –¥  –Ω  –∏  –∫')) {
                    currentMealType = '–ü–æ–ª–¥–Ω–∏–∫';
                    continue;
                }

                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —è—á–µ–π–∫–∏ –≤ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å—Ç–æ–ª–±—Ü–∞—Ö
                for (const colIndex of columns) {
                    const cellValue = (row[colIndex] || '').toString().trim();
                    
                    if (cellValue && cellValue.length > 3 && !isServiceCell(cellValue)) {
                        const dish = cleanDishName(cellValue);
                        if (dish && !dayData[currentMealType].includes(dish)) {
                            dayData[currentMealType].push(dish);
                        }
                    }
                }
            }

            return dayData;
        }

        // –û—á–∏—Å—Ç–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è –±–ª—é–¥–∞
        function cleanDishName(text) {
            // –£–±–∏—Ä–∞–µ–º –Ω–æ–º–µ—Ä–∞ –ø–æ—Ä—Ü–∏–π (‚Ññ 1/6, ‚Ññ 11/2, ‚Ññ15/1)
            let cleaned = text.replace(/‚Ññ\s*\d+\/\d+/g, '');
            
            // –£–±–∏—Ä–∞–µ–º –≤–µ—Å (225 –≥, 20 –≥, 200 –≥)
            cleaned = cleaned.replace(/\d+\s*–≥/g, '');
            
            // –£–±–∏—Ä–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à—Ç—É–∫ (2 —à—Ç)
            cleaned = cleaned.replace(/\d+\s*—à—Ç/g, '');
            
            // –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã –∏ –∑–Ω–∞–∫–∏ –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è
            cleaned = cleaned.replace(/\s+/g, ' ').trim();
            cleaned = cleaned.replace(/^[,\-\.\s]+|[,\-\.\s]+$/g, '');
            
            // –£–±–∏—Ä–∞–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
            const serviceWords = ['–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π', '–≥–∞—Ä–Ω–∏—Ä', '–æ–≤–æ—â–Ω–æ–π', '—Å–æ—É—Å—ã', '—Å'];
            for (const word of serviceWords) {
                if (cleaned.toLowerCase().includes(word)) {
                    return null;
                }
            }
            
            return cleaned.length > 2 ? cleaned : null;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª—É–∂–µ–±–Ω–æ–π —è—á–µ–π–∫–∏
        function isServiceCell(text) {
            const lowerText = text.toLowerCase();
            const serviceWords = [
                '‚Ññ', '–∫–æ–ª', '–∏—á–µ', '—Å—Ç–≤', '–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ', '–ø–æ—Ä—Ü–∏–π', '–ø–æ—Ä—Ü–∏–∏', '–Ω–µ–¥–µ–ª—è', '–Ω–µ–¥–µ–ª',
                '–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–≤—Ç–æ—Ä–Ω–∏–∫', '—Å—Ä–µ–¥–∞', '—á–µ—Ç–≤–µ—Ä–≥', '–ø—è—Ç–Ω–∏—Ü–∞', '—Å—É–±–±–æ—Ç–∞', '–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ',
                '–∑–∞–≤—Ç—Ä–∞–∫', '–æ–±–µ–¥', '–ø–æ–ª–¥–Ω–∏–∫', '—É–∂–∏–Ω', '–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π', '–≥–∞—Ä–Ω–∏—Ä', '–∏—Ç–æ–≥–æ', '–≤—Å–µ–≥–æ',
                '–∑  –∞  –≤  —Ç  —Ä  –∞  –∫', '–æ  –±  –µ  –¥', '–ø  –æ  –ª  –¥  –Ω  –∏  –∫'
            ];
            
            return serviceWords.some(word => lowerText.includes(word.toLowerCase()));
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–µ–Ω—é
        function displayMenu(menu) {
            document.getElementById('menuTitle').textContent = `üìã ${menu.title}`;
            document.getElementById('menuCount').textContent = `–í—Å–µ–≥–æ –±–ª—é–¥: ${menu.totalDishes}`;
            
            const menuGrid = document.getElementById('menuGrid');
            menuGrid.innerHTML = '';

            for (const [dayName, dayData] of Object.entries(menu.menu)) {
                const daySection = document.createElement('div');
                daySection.className = 'day-section';
                
                let totalDayDishes = Object.values(dayData).flat().length;
                
                daySection.innerHTML = `
                    <div class="day-header">
                        <div class="day-title">${dayName}</div>
                        <div class="meal-count">${totalDayDishes} –±–ª—é–¥</div>
                    </div>
                `;

                for (const [mealType, dishes] of Object.entries(dayData)) {
                    if (dishes.length > 0) {
                        const mealTypeDiv = document.createElement('div');
                        mealTypeDiv.className = 'meal-type';
                        
                        mealTypeDiv.innerHTML = `
                            <div class="meal-type-title">${mealType} (${dishes.length} –±–ª—é–¥)</div>
                            <div class="meals-grid">
                                ${dishes.map(dish => `
                                    <div class="meal-item">
                                        <div class="meal-name">${dish}</div>
                                    </div>
                                `).join('')}
                            </div>
                        `;
                        
                        daySection.appendChild(mealTypeDiv);
                    }
                }
                
                menuGrid.appendChild(daySection);
            }

            document.getElementById('menuCard').style.display = 'block';
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON
        function exportToJSON() {
            if (!parsedMenu) return;
            
            const jsonOutput = document.getElementById('jsonOutput');
            jsonOutput.textContent = JSON.stringify(parsedMenu.menu, null, 2);
            jsonOutput.style.display = 'block';
            
            // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
            const blob = new Blob([JSON.stringify(parsedMenu.menu, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `menu_${parsedMenu.week.replace(/\s+/g, '_')}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
        function exportToCSV() {
            if (!parsedMenu) return;
            
            let csv = '–î–µ–Ω—å,–¢–∏–ø –ø–∏—Ç–∞–Ω–∏—è,–ë–ª—é–¥–æ\n';
            
            for (const [dayName, dayData] of Object.entries(parsedMenu.menu)) {
                for (const [mealType, dishes] of Object.entries(dayData)) {
                    for (const dish of dishes) {
                        csv += `"${dayName}","${mealType}","${dish}"\n`;
                    }
                }
            }
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `menu_${parsedMenu.week.replace(/\s+/g, '_')}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
        function showProgress(show) {
            document.getElementById('progressBar').style.display = show ? 'block' : 'none';
        }

        function setProgress(percent, text) {
            document.getElementById('progressFill').style.width = `${percent}%`;
            document.getElementById('progressText').textContent = text;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = `message ${type}`;
            messageDiv.style.display = 'block';
        }
    </script>
</body>
</html>
