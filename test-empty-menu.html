<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –ø—É—Å—Ç–æ–≥–æ –º–µ–Ω—é</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
        }
        .test-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            background: #e3f2fd;
            padding: 10px;
            border-radius: 5px;
        }
        .result {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            background: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #4caf50;
        }
        .error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #f44336;
        }
        .info {
            background: #e3f2fd;
            color: #1565c0;
            border: 1px solid #2196f3;
        }
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1976d2;
        }
        .stats {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üçΩÔ∏è –¢–µ—Å—Ç –ø—É—Å—Ç–æ–≥–æ –º–µ–Ω—é</h1>
        
        <div class="stats">
            <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
            <p><strong>Railway API:</strong> <span id="railwayStatus">–ü—Ä–æ–≤–µ—Ä—è–µ–º...</span></p>
            <p><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª—é–¥:</strong> <span id="dishCount">0</span></p>
            <p><strong>–í–µ—Ä—Å–∏—è:</strong> <span id="version">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span></p>
        </div>

        <div class="test-section">
            <div class="test-title">üîç –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ Railway API</div>
            <div id="railwayTest" class="result info">–ü—Ä–æ–≤–µ—Ä—è–µ–º Railway API...</div>
            <button onclick="testRailwayAPI()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Railway</button>
        </div>

        <div class="test-section">
            <div class="test-title">üóëÔ∏è –¢–µ—Å—Ç 2: –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –±–ª—é–¥</div>
            <div id="deleteTest" class="result info">–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é...</div>
            <button onclick="testDeleteAll()">–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –±–ª—é–¥–∞</button>
        </div>

        <div class="test-section">
            <div class="test-title">üì§ –¢–µ—Å—Ç 3: –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞</div>
            <div id="uploadTest" class="result info">–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é...</div>
            <button onclick="testFileUpload()">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª</button>
        </div>

        <div class="test-section">
            <div class="test-title">üìã –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–Ω–µ–ª–∏ —Ä–æ–¥–∏—Ç–µ–ª—è</div>
            <div id="parentTest" class="result info">–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é...</div>
            <button onclick="testParentPanel()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞–Ω–µ–ª—å —Ä–æ–¥–∏—Ç–µ–ª—è</button>
        </div>
    </div>

    <script>
        const RAILWAY_URL = 'https://fermiy100githubio-production.up.railway.app';
        const FERMIY_URL = 'https://fermiy.ru';

        async function testRailwayAPI() {
            const testDiv = document.getElementById('railwayTest');
            testDiv.innerHTML = '–ü—Ä–æ–≤–µ—Ä—è–µ–º Railway API...';
            testDiv.className = 'result info';

            try {
                const response = await fetch(RAILWAY_URL);
                const data = await response.json();
                
                document.getElementById('railwayStatus').textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω';
                document.getElementById('dishCount').textContent = data.dishCount || 0;
                document.getElementById('version').textContent = data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                
                if (data.dishCount === 0) {
                    testDiv.innerHTML = `‚úÖ Railway API —Ä–∞–±–æ—Ç–∞–µ—Ç! –ú–µ–Ω—é –ø—É—Å—Ç–æ–µ (${data.dishCount} –±–ª—é–¥)`;
                    testDiv.className = 'result success';
                } else {
                    testDiv.innerHTML = `‚ö†Ô∏è Railway API —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –º–µ–Ω—é –Ω–µ –ø—É—Å—Ç–æ–µ (${data.dishCount} –±–ª—é–¥)`;
                    testDiv.className = 'result error';
                }
            } catch (error) {
                testDiv.innerHTML = `‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Railway: ${error.message}`;
                testDiv.className = 'result error';
            }
        }

        async function testDeleteAll() {
            const testDiv = document.getElementById('deleteTest');
            testDiv.innerHTML = '–£–¥–∞–ª—è–µ–º –≤—Å–µ –±–ª—é–¥–∞...';
            testDiv.className = 'result info';

            try {
                const response = await fetch(`${RAILWAY_URL}/api/menu/clear`, {
                    method: 'DELETE'
                });
                const data = await response.json();
                
                if (data.success && data.deletedCount !== undefined) {
                    testDiv.innerHTML = `‚úÖ –£—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ ${data.deletedCount} –±–ª—é–¥`;
                    testDiv.className = 'result success';
                } else {
                    testDiv.innerHTML = `‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ${data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`;
                    testDiv.className = 'result error';
                }
            } catch (error) {
                testDiv.innerHTML = `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ${error.message}`;
                testDiv.className = 'result error';
            }
        }

        async function testFileUpload() {
            const testDiv = document.getElementById('uploadTest');
            testDiv.innerHTML = '–ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª...';
            testDiv.className = 'result info';

            try {
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
                const testFile = new File(['test content'], 'test.txt', { type: 'text/plain' });
                const formData = new FormData();
                formData.append('file', testFile);

                const response = await fetch(`${RAILWAY_URL}/api/menu`, {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                
                if (data.success) {
                    testDiv.innerHTML = `‚úÖ –§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω! –î–æ–±–∞–≤–ª–µ–Ω–æ ${data.addedCount || 0} –±–ª—é–¥`;
                    testDiv.className = 'result success';
                } else {
                    testDiv.innerHTML = `‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`;
                    testDiv.className = 'result error';
                }
            } catch (error) {
                testDiv.innerHTML = `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ: ${error.message}`;
                testDiv.className = 'result error';
            }
        }

        async function testParentPanel() {
            const testDiv = document.getElementById('parentTest');
            testDiv.innerHTML = '–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞–Ω–µ–ª—å —Ä–æ–¥–∏—Ç–µ–ª—è...';
            testDiv.className = 'result info';

            try {
                const response = await fetch(`${RAILWAY_URL}/api/menu`);
                const data = await response.json();
                
                if (Array.isArray(data)) {
                    const breakfastCount = data.filter(dish => dish.meal_type === '–∑–∞–≤—Ç—Ä–∞–∫').length;
                    const lunchCount = data.filter(dish => dish.meal_type === '–æ–±–µ–¥').length;
                    const snackCount = data.filter(dish => dish.meal_type === '–ø–æ–ª–¥–Ω–∏–∫').length;
                    
                    testDiv.innerHTML = `‚úÖ –ü–∞–Ω–µ–ª—å —Ä–æ–¥–∏—Ç–µ–ª—è –≥–æ—Ç–æ–≤–∞!<br>
                        –ó–∞–≤—Ç—Ä–∞–∫: ${breakfastCount} –±–ª—é–¥<br>
                        –û–±–µ–¥: ${lunchCount} –±–ª—é–¥<br>
                        –ü–æ–ª–¥–Ω–∏–∫: ${snackCount} –±–ª—é–¥<br>
                        –í—Å–µ–≥–æ: ${data.length} –±–ª—é–¥`;
                    testDiv.className = 'result success';
                } else {
                    testDiv.innerHTML = `‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö: ${JSON.stringify(data)}`;
                    testDiv.className = 'result error';
                }
            } catch (error) {
                testDiv.innerHTML = `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–∞–Ω–µ–ª–∏ —Ä–æ–¥–∏—Ç–µ–ª—è: ${error.message}`;
                testDiv.className = 'result error';
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º Railway API –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            testRailwayAPI();
        };
    </script>
</body>
</html>
